import { ChallengeTitle } from "../../../../components/Challenges/ChallengeTitle";
import { RequirementList } from "../../../../components/Challenges/RequirementList";
import { Requirement } from "../../../../components/Challenges/Requirement";

<ChallengeTitle>sBPF Assembly Slippage</ChallengeTitle>

Bây giờ là lúc bạn nên bắt đầu cảm thấy thoải mái khi viết Assembly, thay vì chỉ sử dụng một tài khoản bình thường, kiểm tra slippage của bạn nên hoạt động cho cả các tài khoản SPL-Token và Token2022.

> Số lượng `amount` sẽ được đặt trong bộ nhớ tại cùng một hằng số như ví dụ. Sự khác biệt chính là chúng ta không thể lấy dữ liệu instruction bằng cách sử dụng một hằng số vì độ dài dữ liệu `data_len` của tài khoản là động (dữ liệu instruction nằm ở phần cuối của dữ liệu của tài khoản cuối cùng).

Hãy tạo một chương trình chỉ có 1 instruction. Nó phải:
- Nhận vào một tài khoản token SPL hoặc Token2022
- Nhận vào một số lượng tối thiểu ở dạng 8-byte trong dữ liệu instruction
- Tính toán động độ lệch đến số lượng tối thiểu
- Nếu vượt quá slippage, ghi log với chuỗi `Slippage exceeded` và trả về mã lỗi 1

> Để lấy đúng độ lệch dữ liệu instruction, bạn có thể sử dụng công cụ của chúng tôi tại [sbpf.xyz](https://sbpf.xyz). Nhưng chúng tôi sẽ giúp bạn: độ dài dữ liệu của tài khoản token nằm ở `.equ TOKEN_ACCOUNT_DATA_LEN, 0x0058`

Bắt đầu bằng cách cài đặt các gói công cụ sBPF như được mô tả trong phần [Công cụ](/vi/courses/introduction-to-assembly/tooling) của khóa học Giới thiệu về Assembly và build chương trình của bạn bằng lệnh sau trong terminal:

```
sbpf build
```

Điều này sẽ tạo ra một file `.so` trong thư mục `target/deploy` của bạn.

Bây giờ hãy nhấp vào nút `take challenge` và thả file đó vào đó!

<RequirementList>
  <Requirement title="Thử thách 1: Kiểm thử Slippage với SPL-Token">
    Chương trình của bạn nên thành công khi số lượng token trong một tài khoản SPL-Token lớn hơn số lượng được truyền vào.
  </Requirement>

  <Requirement title="Thử thách 2: Kiểm thử trường hợp thất bại của Slippage">
    Chương trình của bạn nên thất bại khi số lượng token trong một tài khoản SPL-Token nhỏ hơn số lượng được truyền vào.
  </Requirement>

  <Requirement title="Thử thách 3: Kiểm thử Slippage với Token2022">
    Chương trình của bạn nên thành công khi số lượng token trong một tài khoản Token2022 lớn hơn số lượng được truyền vào.
  </Requirement>
</RequirementList>